<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diploma Thesis DAW-Controller: Button Matrix: Source</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="mdw_Logo_weiss.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">Diploma Thesis DAW-Controller: Button Matrix<span id="projectnumber">&#160;Demo Project</span>
   </div>
   <div id="projectbrief">This Project shows how to setup and use a button matrix.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group___t_s_c_button___source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">Source<div class="ingroups"><a class="el" href="group___motor_fader.html">Motorized Fader</a> &raquo; <a class="el" href="group___t_s_c_button.html">TSC Button</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Study this part for details about this module.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_t_s_c_button__internal__struct_td.html">TSCButton_internal_structTd</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure for internal use. All initialized buttons will be linked here.  <a href="struct_t_s_c_button__internal__struct_td.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga9ac342a985d81440a29a663c1c885ed2" id="r_ga9ac342a985d81440a29a663c1c885ed2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_t_s_c_button__internal__struct_td.html">TSCButton_internal_structTd</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga9ac342a985d81440a29a663c1c885ed2">TSC_Internal</a></td></tr>
<tr class="memdesc:ga9ac342a985d81440a29a663c1c885ed2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object of <a class="el" href="struct_t_s_c_button__internal__struct_td.html" title="Structure for internal use. All initialized buttons will be linked here.">TSCButton_internal_structTd</a> type to save internal data.  <br /></td></tr>
<tr class="separator:ga9ac342a985d81440a29a663c1c885ed2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Initialize</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>Use these functions to initialize the touch sense controller based button. </p>
</td></tr>
<tr class="memitem:gadea3910a50802013c61688c34af42b2a" id="r_gadea3910a50802013c61688c34af42b2a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gadea3910a50802013c61688c34af42b2a">TSCButton_init_TSC</a> (<a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *tsc, TSC_HandleTypeDef *htsc, uint32_t IOChannel)</td></tr>
<tr class="memdesc:gadea3910a50802013c61688c34af42b2a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Link the htsc handler to this module and specify the IO Channel. All Buttons have to be initialized before starting TSC. If you add buttons while TSC is running, internal counters might get confused and crash the program.  <br /></td></tr>
<tr class="separator:gadea3910a50802013c61688c34af42b2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf250403787c21743f4c5948cec732bfa" id="r_gaf250403787c21743f4c5948cec732bfa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaf250403787c21743f4c5948cec732bfa">link_ButtonToInternalStructure</a> (<a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *tsc)</td></tr>
<tr class="memdesc:gaf250403787c21743f4c5948cec732bfa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Link the pointer to a TSCButton to the internal structure used for the acquisition management.  <br /></td></tr>
<tr class="separator:gaf250403787c21743f4c5948cec732bfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac57af5ede8b02114fa5a62835bbc6a66" id="r_gac57af5ede8b02114fa5a62835bbc6a66"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gac57af5ede8b02114fa5a62835bbc6a66">extract_GroupNumberFromIOCCRMask</a> (uint32_t Bitmask)</td></tr>
<tr class="memdesc:gac57af5ede8b02114fa5a62835bbc6a66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract the group number of a IO-Bitmask. This Bitmask has to match the TSC_IOCCR_Gx_IOx masks.  <br /></td></tr>
<tr class="separator:gac57af5ede8b02114fa5a62835bbc6a66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac563acc8b2838373da3cf6dee8127810" id="r_gac563acc8b2838373da3cf6dee8127810"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gac563acc8b2838373da3cf6dee8127810">TSCButton_init_Threshold</a> (<a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *tsc, uint16_t value)</td></tr>
<tr class="memdesc:gac563acc8b2838373da3cf6dee8127810"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the threshold where the TSC button will toggle between touched and released.  <br /></td></tr>
<tr class="separator:gac563acc8b2838373da3cf6dee8127810"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf706cac3ee0be2f3f1770d87953f2c03" id="r_gaf706cac3ee0be2f3f1770d87953f2c03"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaf706cac3ee0be2f3f1770d87953f2c03">TSCButton_init_DischargeTimeMsAll</a> (uint8_t value)</td></tr>
<tr class="memdesc:gaf706cac3ee0be2f3f1770d87953f2c03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the discharge time in ms, that is required to discharge the sensing capacitor. Depending on the used capacitor, 1ms may be enough.  <br /></td></tr>
<tr class="separator:gaf706cac3ee0be2f3f1770d87953f2c03"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Process TSC</h2></td></tr>
<tr class="memitem:ga503e1c587002f993ecfb62f6ad0209e4" id="r_ga503e1c587002f993ecfb62f6ad0209e4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga503e1c587002f993ecfb62f6ad0209e4">TSCButton_start_All</a> (void)</td></tr>
<tr class="memdesc:ga503e1c587002f993ecfb62f6ad0209e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function sets the module to start conditions.  <br /></td></tr>
<tr class="separator:ga503e1c587002f993ecfb62f6ad0209e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad583fc1b4a691826653bcb2dd5d52278" id="r_gad583fc1b4a691826653bcb2dd5d52278"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gad583fc1b4a691826653bcb2dd5d52278">TSCButton_update_All</a> (void)</td></tr>
<tr class="memdesc:gad583fc1b4a691826653bcb2dd5d52278"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the TSC for all buttons. Calöl this funciton periodically in the main while loop.  <br /></td></tr>
<tr class="separator:gad583fc1b4a691826653bcb2dd5d52278"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa552bcc173468c8f41d4e557c773a6fa" id="r_gaa552bcc173468c8f41d4e557c773a6fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaa552bcc173468c8f41d4e557c773a6fa">block_TSCForSomeMs</a> (uint32_t BlockingTime)</td></tr>
<tr class="memdesc:gaa552bcc173468c8f41d4e557c773a6fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to block the TSC for a specific time in ms. This will only block the TSC, not the whole program.  <br /></td></tr>
<tr class="separator:gaa552bcc173468c8f41d4e557c773a6fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa7c07d6611cdcdb134bbd8cd6166bd78" id="r_gaa7c07d6611cdcdb134bbd8cd6166bd78"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaa7c07d6611cdcdb134bbd8cd6166bd78">check_TSCBlocked</a> (void)</td></tr>
<tr class="memdesc:gaa7c07d6611cdcdb134bbd8cd6166bd78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if TSC is blocked.  <br /></td></tr>
<tr class="separator:gaa7c07d6611cdcdb134bbd8cd6166bd78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3f3eb1cea7667667d72d479afcc25e54" id="r_ga3f3eb1cea7667667d72d479afcc25e54"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga3f3eb1cea7667667d72d479afcc25e54">store_TSCSample</a> (<a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *tsc, uint32_t Sample)</td></tr>
<tr class="memdesc:ga3f3eb1cea7667667d72d479afcc25e54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store the current TSC sample to the structure.  <br /></td></tr>
<tr class="separator:ga3f3eb1cea7667667d72d479afcc25e54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga47b9abb680708ace7f53acc126f1ec34" id="r_ga47b9abb680708ace7f53acc126f1ec34"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga47b9abb680708ace7f53acc126f1ec34">calculate_SmoothTSCValue</a> (<a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *tsc)</td></tr>
<tr class="memdesc:ga47b9abb680708ace7f53acc126f1ec34"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate an average of all available samples.  <br /></td></tr>
<tr class="separator:ga47b9abb680708ace7f53acc126f1ec34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6d0f0d7afe447ace681bcdd6dd0d99c4" id="r_ga6d0f0d7afe447ace681bcdd6dd0d99c4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6d0f0d7afe447ace681bcdd6dd0d99c4">TSCButton_manage_Interrupt</a> ()</td></tr>
<tr class="memdesc:ga6d0f0d7afe447ace681bcdd6dd0d99c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function in the HAL-Interrupt handler to set an internal interrupt flag for the TSC module.  <br /></td></tr>
<tr class="separator:ga6d0f0d7afe447ace681bcdd6dd0d99c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Get Functions</h2></td></tr>
<tr class="memitem:ga7e38c54496d42ef7c41976a83607771f" id="r_ga7e38c54496d42ef7c41976a83607771f"><td class="memItemLeft" align="right" valign="top">TSCButton_State_enumTd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga7e38c54496d42ef7c41976a83607771f">TSCButton_get_State</a> (<a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *tsc)</td></tr>
<tr class="memdesc:ga7e38c54496d42ef7c41976a83607771f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the current state of a TSC-Button.  <br /></td></tr>
<tr class="separator:ga7e38c54496d42ef7c41976a83607771f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0d1e776091a3e9e11271ce42b3d75fc3" id="r_ga0d1e776091a3e9e11271ce42b3d75fc3"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga0d1e776091a3e9e11271ce42b3d75fc3">TSCButton_get_RawValue</a> (<a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *tsc)</td></tr>
<tr class="memdesc:ga0d1e776091a3e9e11271ce42b3d75fc3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the current raw TSC value of a Button.  <br /></td></tr>
<tr class="separator:ga0d1e776091a3e9e11271ce42b3d75fc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga235992141af696bf45579dd8f8604596" id="r_ga235992141af696bf45579dd8f8604596"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga235992141af696bf45579dd8f8604596">TSCButton_get_SmoothValue</a> (<a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *tsc)</td></tr>
<tr class="memdesc:ga235992141af696bf45579dd8f8604596"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the current smooth TSC value of a Button.  <br /></td></tr>
<tr class="separator:ga235992141af696bf45579dd8f8604596"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Study this part for details about this module. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaa552bcc173468c8f41d4e557c773a6fa" name="gaa552bcc173468c8f41d4e557c773a6fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa552bcc173468c8f41d4e557c773a6fa">&#9670;&#160;</a></span>block_TSCForSomeMs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void block_TSCForSomeMs </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>BlockingTime</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to block the TSC for a specific time in ms. This will only block the TSC, not the whole program. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">BlockingTime</td><td>in milli seconds </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>

</div>
</div>
<a id="ga47b9abb680708ace7f53acc126f1ec34" name="ga47b9abb680708ace7f53acc126f1ec34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga47b9abb680708ace7f53acc126f1ec34">&#9670;&#160;</a></span>calculate_SmoothTSCValue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calculate_SmoothTSCValue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>tsc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate an average of all available samples. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tsc</td><td>pointer to the users tsc structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Declare a variable to store the sum of all samples</p>
<p>2. Calculate the sum of all samples</p>
<p>3. Divide the sum of all samples by the <a class="el" href="group___t_s_c_button___header.html#ga90dc25b901f609dad85bc9ac4c96ef3d">TSC_NUM_SAMPLES</a> to get the smoothed value.</p>

</div>
</div>
<a id="gaa7c07d6611cdcdb134bbd8cd6166bd78" name="gaa7c07d6611cdcdb134bbd8cd6166bd78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa7c07d6611cdcdb134bbd8cd6166bd78">&#9670;&#160;</a></span>check_TSCBlocked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool check_TSCBlocked </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if TSC is blocked. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if TSC is blocked, false if not </dd></dl>

</div>
</div>
<a id="gac57af5ede8b02114fa5a62835bbc6a66" name="gac57af5ede8b02114fa5a62835bbc6a66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac57af5ede8b02114fa5a62835bbc6a66">&#9670;&#160;</a></span>extract_GroupNumberFromIOCCRMask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t extract_GroupNumberFromIOCCRMask </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>Bitmask</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Extract the group number of a IO-Bitmask. This Bitmask has to match the TSC_IOCCR_Gx_IOx masks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Bitmask</td><td>to be extracted </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TSC-Channel Number that will be used for HAL_TSC_IOConfig() </dd></dl>
<p>1. Declare Variables for internal use</p>
<p>2. Loop through all available groups.</p>
<p>3. Calculate a compare bitmask.</p>
<p>4. Use the compare bitmask to check it a bit of the group is set. If yes: Set the return value to the current group number of the loop. <br  />
</p>

</div>
</div>
<a id="gaf250403787c21743f4c5948cec732bfa" name="gaf250403787c21743f4c5948cec732bfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf250403787c21743f4c5948cec732bfa">&#9670;&#160;</a></span>link_ButtonToInternalStructure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void link_ButtonToInternalStructure </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>tsc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Link the pointer to a TSCButton to the internal structure used for the acquisition management. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tsc</td><td>pointer to the users tsc structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>

</div>
</div>
<a id="ga3f3eb1cea7667667d72d479afcc25e54" name="ga3f3eb1cea7667667d72d479afcc25e54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3f3eb1cea7667667d72d479afcc25e54">&#9670;&#160;</a></span>store_TSCSample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void store_TSCSample </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>tsc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>Sample</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Store the current TSC sample to the structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tsc</td><td>pointer to the users tsc structure </td></tr>
    <tr><td class="paramname">Sample</td><td>of the current TSC measurement </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Copy Sample to Sample Array at current Array-Index</p>
<p>2. Copy Sample to Value Raw to be able to return it quick to the user if needed.</p>
<p>3. Count up the sample array index for the next value.</p>
<p>4. If sample array index reaches the defined <a class="el" href="group___t_s_c_button___header.html#ga90dc25b901f609dad85bc9ac4c96ef3d">TSC_NUM_SAMPLES</a>, reset the index. The following values will overwrite the old ones.</p>

</div>
</div>
<a id="ga0d1e776091a3e9e11271ce42b3d75fc3" name="ga0d1e776091a3e9e11271ce42b3d75fc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0d1e776091a3e9e11271ce42b3d75fc3">&#9670;&#160;</a></span>TSCButton_get_RawValue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t TSCButton_get_RawValue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>tsc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the current raw TSC value of a Button. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tsc</td><td>pointer to the users tsc structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>value of the last TSC measurement for this tsc structure </dd></dl>

</div>
</div>
<a id="ga235992141af696bf45579dd8f8604596" name="ga235992141af696bf45579dd8f8604596"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga235992141af696bf45579dd8f8604596">&#9670;&#160;</a></span>TSCButton_get_SmoothValue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t TSCButton_get_SmoothValue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>tsc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the current smooth TSC value of a Button. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tsc</td><td>pointer to the users tsc structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>value of the last TSC measurement for this tsc structure </dd></dl>

</div>
</div>
<a id="ga7e38c54496d42ef7c41976a83607771f" name="ga7e38c54496d42ef7c41976a83607771f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7e38c54496d42ef7c41976a83607771f">&#9670;&#160;</a></span>TSCButton_get_State()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TSCButton_State_enumTd TSCButton_get_State </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>tsc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the current state of a TSC-Button. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tsc</td><td>pointer to the users tsc structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>state of the tsc structure. </dd></dl>

</div>
</div>
<a id="gaf706cac3ee0be2f3f1770d87953f2c03" name="gaf706cac3ee0be2f3f1770d87953f2c03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf706cac3ee0be2f3f1770d87953f2c03">&#9670;&#160;</a></span>TSCButton_init_DischargeTimeMsAll()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TSCButton_init_DischargeTimeMsAll </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>value</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup the discharge time in ms, that is required to discharge the sensing capacitor. Depending on the used capacitor, 1ms may be enough. </p>
<dl class="section note"><dt>Note</dt><dd>Only setup this value once for all TSC Keys! Adapt the value to the slowest sampling capacitor. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">value</td><td>of the discharge time </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. save the capacitor discharge time</p>

</div>
</div>
<a id="gac563acc8b2838373da3cf6dee8127810" name="gac563acc8b2838373da3cf6dee8127810"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac563acc8b2838373da3cf6dee8127810">&#9670;&#160;</a></span>TSCButton_init_Threshold()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TSCButton_init_Threshold </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>tsc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>value</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup the threshold where the TSC button will toggle between touched and released. </p>
<dl class="section note"><dt>Note</dt><dd>How to evaluate a proper value:<ol type="1">
<li>Let the TSC button run without a threshold</li>
<li>read the raw value (e.g. with live expression) and look what the values are when touched and when released.</li>
<li>Choose a value in between and set it up as threshold. Tip: If the value difference is so small, that noise and environment changes overlap, increase the Charge Transfer High/Low Pulse Length. This will increase the value range from touched to released. </li>
</ol>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tsc</td><td>pointer to the users tsc structure </td></tr>
    <tr><td class="paramname">value</td><td>of the threshold </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. save threshold value for the tsc to change state</p>

</div>
</div>
<a id="gadea3910a50802013c61688c34af42b2a" name="gadea3910a50802013c61688c34af42b2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadea3910a50802013c61688c34af42b2a">&#9670;&#160;</a></span>TSCButton_init_TSC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TSCButton_init_TSC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_s_c_button__struct_td.html">TSCButton_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>tsc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TSC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>htsc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>IOChannel</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Link the htsc handler to this module and specify the IO Channel. All Buttons have to be initialized before starting TSC. If you add buttons while TSC is running, internal counters might get confused and crash the program. </p>
<h1><a class="anchor" id="autotoc_md29"></a>
How to setup TSC in Cube MX (Values used for testing):</h1>
<ul>
<li>For each used group:<ul>
<li>Setup 1 sample capacitor</li>
<li>Setup 1 to 3 TSC Lines</li>
</ul>
</li>
<li>Parameter Settings:<ul>
<li>Charge Transfer High/Low Pulse Length: 6 Cycles (Other sized do work, but with shorter cycles the values get very close to each other when touched and released, what makes it difficult to get accurate touched or released detection. Larger values might be too slow for some use cases.)</li>
<li>Speed Spectrum: Disable</li>
<li>Pulse Generator Prescaler: Synchronous clock divided by 4 (tested with HCLK: 32MHz)</li>
<li>Maximum Count Value: 8191 charge transfer cycles</li>
<li>IO Default Mode: Output push-pull low</li>
<li>Acquisition Mode: Normal acquisition mode</li>
<li>Maximum Count Interrupt: Disable</li>
</ul>
</li>
<li>NVIC Settings:<ul>
<li>Touch sense controller interrupt: Enabled</li>
</ul>
</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tsc</td><td>pointer to the users tsc structure </td></tr>
    <tr><td class="paramname">htsc</td><td>pointer to the HAL generated TSC-handle of the TSC that is used for the button </td></tr>
    <tr><td class="paramname">IOChannel</td><td>channel of the TSC-Group used for this button. Please use the HAL defines that contain the proper register values. This is the naming convention: TSC_GROUPx_IOx. You can find the active channels in the htsc initialization in MX_TSC_init(). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. link HAL generated tsc handler (htsc)</p>
<p>2. Copy configuration settings from htsc to TSC_IOConfigTypeDef ioConfigTsc. This is necessary for the use of some HAL TSC functions.</p>
<p>3. Extract group number from IOChannel and save it</p>
<p>4. link button structure to the internal structure</p>

</div>
</div>
<a id="ga6d0f0d7afe447ace681bcdd6dd0d99c4" name="ga6d0f0d7afe447ace681bcdd6dd0d99c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6d0f0d7afe447ace681bcdd6dd0d99c4">&#9670;&#160;</a></span>TSCButton_manage_Interrupt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TSCButton_manage_Interrupt </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function in the HAL-Interrupt handler to set an internal interrupt flag for the TSC module. </p>
<p>Here is an example: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> HAL_TSC_ConvCpltCallback(TSC_HandleTypeDef* htsc)</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_function" href="group___t_s_c_button___header.html#ga9a0bf2ea0b4d926c1ae1724ae86b24fc">TSCButton_manage_Interrupt</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup___t_s_c_button___header_html_ga9a0bf2ea0b4d926c1ae1724ae86b24fc"><div class="ttname"><a href="group___t_s_c_button___header.html#ga9a0bf2ea0b4d926c1ae1724ae86b24fc">TSCButton_manage_Interrupt</a></div><div class="ttdeci">void TSCButton_manage_Interrupt(void)</div><div class="ttdoc">Call this function in the HAL-Interrupt handler to set an internal interrupt flag for the TSC module.</div><div class="ttdef"><b>Definition</b> tscButton.c:310</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>

</div>
</div>
<a id="ga503e1c587002f993ecfb62f6ad0209e4" name="ga503e1c587002f993ecfb62f6ad0209e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga503e1c587002f993ecfb62f6ad0209e4">&#9670;&#160;</a></span>TSCButton_start_All()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TSCButton_start_All </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function sets the module to start conditions. </p>
<dl class="section note"><dt>Note</dt><dd>This function must be called once before updating and after initialization. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. set button current button index to 0</p>

</div>
</div>
<a id="gad583fc1b4a691826653bcb2dd5d52278" name="gad583fc1b4a691826653bcb2dd5d52278"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad583fc1b4a691826653bcb2dd5d52278">&#9670;&#160;</a></span>TSCButton_update_All()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TSCButton_update_All </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the TSC for all buttons. Calöl this funciton periodically in the main while loop. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Check if TSC is blocked.</p><ul>
<li>If yes: leave function</li>
</ul>
<p>2. Check it TSC is already running</p><ul>
<li>If not: start TSC</li>
</ul>
<p>3. Check if TSC was interrupted.</p><ul>
<li>If not: leave function</li>
</ul>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ga9ac342a985d81440a29a663c1c885ed2" name="ga9ac342a985d81440a29a663c1c885ed2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9ac342a985d81440a29a663c1c885ed2">&#9670;&#160;</a></span>TSC_Internal</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_t_s_c_button__internal__struct_td.html">TSCButton_internal_structTd</a> TSC_Internal</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    .CurrentButtonIndex = 0,</div>
<div class="line">    .NumButtons = 0,</div>
<div class="line">    .interrupted = <span class="keyword">false</span>,</div>
<div class="line">    .TSCBlocked = <span class="keyword">false</span>,</div>
<div class="line">    .TSCStarted = <span class="keyword">false</span>,</div>
<div class="line">}</div>
</div><!-- fragment -->
<p>Object of <a class="el" href="struct_t_s_c_button__internal__struct_td.html" title="Structure for internal use. All initialized buttons will be linked here.">TSCButton_internal_structTd</a> type to save internal data. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
