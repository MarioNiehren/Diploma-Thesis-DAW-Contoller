<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diploma Thesis DAW-Controller: Button Matrix: Source Code</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="mdw_Logo_weiss.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">Diploma Thesis DAW-Controller: Button Matrix<span id="projectnumber">&#160;Demo Project</span>
   </div>
   <div id="projectbrief">This Project shows how to setup and use a button matrix.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group___wiper___source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">Source Code<div class="ingroups"><a class="el" href="group___motor_fader.html">Motorized Fader</a> &raquo; <a class="el" href="group___wiper_motor_fader.html">Wiper module</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Study this part for details about the function of wipers.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:wiper_8c" id="r_wiper_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wiper_8c.html">wiper.c</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_wiper___a_d_cdescriptor__struct_td.html">Wiper_ADCdescriptor_structTd</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure that contains all data for an ADC.  <a href="struct_wiper___a_d_cdescriptor__struct_td.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_wiper___internal___struct_td.html">Wiper_Internal_StructTd</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure that contains all active ADCs. This is for internal use only.  <a href="struct_wiper___internal___struct_td.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:gabd56317a66c831f9d7f892101def99ef" id="r_gabd56317a66c831f9d7f892101def99ef"><td class="memItemLeft" align="right" valign="top"><a id="gabd56317a66c831f9d7f892101def99ef" name="gabd56317a66c831f9d7f892101def99ef"></a>
<a class="el" href="struct_wiper___internal___struct_td.html">Wiper_Internal_StructTd</a>&#160;</td><td class="memItemRight" valign="bottom"><b>WiperInternal</b> = {0}</td></tr>
<tr class="memdesc:gabd56317a66c831f9d7f892101def99ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object of <a class="el" href="struct_wiper___internal___struct_td.html" title="Structure that contains all active ADCs. This is for internal use only.">Wiper_Internal_StructTd</a> type to store data needed inside this module. <br /></td></tr>
<tr class="separator:gabd56317a66c831f9d7f892101def99ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Initialize</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>Use these functions to initialize the wiper of the fader </p>
</td></tr>
<tr class="memitem:ga3769a4718f132d3298e7c6a9456667e9" id="r_ga3769a4718f132d3298e7c6a9456667e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga3769a4718f132d3298e7c6a9456667e9">Wiper_init_ADC</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper, ADC_HandleTypeDef *hadc)</td></tr>
<tr class="memdesc:ga3769a4718f132d3298e7c6a9456667e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Link HAL-ADC-handle used for wiper.  <br /></td></tr>
<tr class="separator:ga3769a4718f132d3298e7c6a9456667e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga352768ca68e895645421a03936912afb" id="r_ga352768ca68e895645421a03936912afb"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga352768ca68e895645421a03936912afb">check_ADCAlreadyInUse</a> (ADC_HandleTypeDef *hadc)</td></tr>
<tr class="memdesc:ga352768ca68e895645421a03936912afb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the ADC-handler is already linked to the internal structure.  <br /></td></tr>
<tr class="separator:ga352768ca68e895645421a03936912afb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabcd8f67f9c76aee8447a9432432c6ecd" id="r_gabcd8f67f9c76aee8447a9432432c6ecd"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gabcd8f67f9c76aee8447a9432432c6ecd">get_ValidADCIndex</a> (ADC_HandleTypeDef *hadc)</td></tr>
<tr class="memdesc:gabcd8f67f9c76aee8447a9432432c6ecd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the index of an ADC that is already linked to the internal structure.  <br /></td></tr>
<tr class="separator:gabcd8f67f9c76aee8447a9432432c6ecd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa1787e49726ff7779fcc109cf923cbd2" id="r_gaa1787e49726ff7779fcc109cf923cbd2"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaa1787e49726ff7779fcc109cf923cbd2">get_NextFreeADCIndex</a> (ADC_HandleTypeDef *hadc)</td></tr>
<tr class="memdesc:gaa1787e49726ff7779fcc109cf923cbd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the index number of the next free space in the ADC array of the internal structure.  <br /></td></tr>
<tr class="separator:gaa1787e49726ff7779fcc109cf923cbd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5dbc86bfd35ccd57acbe7b9def5cb1e0" id="r_ga5dbc86bfd35ccd57acbe7b9def5cb1e0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga5dbc86bfd35ccd57acbe7b9def5cb1e0">link_hadc</a> (ADC_HandleTypeDef *hadc, uint8_t IndexADC)</td></tr>
<tr class="memdesc:ga5dbc86bfd35ccd57acbe7b9def5cb1e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">link the hadc to the internal structure.  <br /></td></tr>
<tr class="separator:ga5dbc86bfd35ccd57acbe7b9def5cb1e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga05d9a5a79f457185a2fa101ab8971e69" id="r_ga05d9a5a79f457185a2fa101ab8971e69"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga05d9a5a79f457185a2fa101ab8971e69">link_WiperToInternalStructure</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper, uint8_t IndexADC)</td></tr>
<tr class="memdesc:ga05d9a5a79f457185a2fa101ab8971e69"><td class="mdescLeft">&#160;</td><td class="mdescRight">link ADC relevant parts of the wiper structure to the internal structure  <br /></td></tr>
<tr class="separator:ga05d9a5a79f457185a2fa101ab8971e69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6ea4077964bf0c78ed5cb2e918fe07e7" id="r_ga6ea4077964bf0c78ed5cb2e918fe07e7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6ea4077964bf0c78ed5cb2e918fe07e7">Wiper_init_Hysteresis</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper)</td></tr>
<tr class="memdesc:ga6ea4077964bf0c78ed5cb2e918fe07e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set hysteresis settings to default.  <br /></td></tr>
<tr class="separator:ga6ea4077964bf0c78ed5cb2e918fe07e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Calibrate</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>Use this function to calibrate the wiper</p>
<dl class="section note"><dt>Note</dt><dd>These functions are not essential, but may be helpful to improve the performance. </dd></dl>
</td></tr>
<tr class="memitem:ga1e29bd553a21cdf0ceb9d3c14b45a755" id="r_ga1e29bd553a21cdf0ceb9d3c14b45a755"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga1e29bd553a21cdf0ceb9d3c14b45a755">Wiper_calibrate_HysteresisThreshold</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper, uint8_t Threshold)</td></tr>
<tr class="memdesc:ga1e29bd553a21cdf0ceb9d3c14b45a755"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calibrate the hysteresis threshold.  <br /></td></tr>
<tr class="separator:ga1e29bd553a21cdf0ceb9d3c14b45a755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab4493630c4a3361e1b45694ded6d1fe6" id="r_gab4493630c4a3361e1b45694ded6d1fe6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gab4493630c4a3361e1b45694ded6d1fe6">Wiper_calibrate_HysteresisDeviationThreshold</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper, uint8_t Threshold)</td></tr>
<tr class="memdesc:gab4493630c4a3361e1b45694ded6d1fe6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calibrate the Deviation Threshold. This will define, when the value will be corrected, if the value thrifts inside the hysteresis threshold.  <br /></td></tr>
<tr class="separator:gab4493630c4a3361e1b45694ded6d1fe6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Process ADC</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>Use these functions to update the ADC values </p>
</td></tr>
<tr class="memitem:ga98a7e3568b3c8c797e29f3178f370f52" id="r_ga98a7e3568b3c8c797e29f3178f370f52"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga98a7e3568b3c8c797e29f3178f370f52">Wiper_start_All</a> (void)</td></tr>
<tr class="memdesc:ga98a7e3568b3c8c797e29f3178f370f52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to start the ADC over DMA conversion. Call this function once when the ADC should start.  <br /></td></tr>
<tr class="separator:ga98a7e3568b3c8c797e29f3178f370f52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4520e2fb456df3472ea105accd8e29fe" id="r_ga4520e2fb456df3472ea105accd8e29fe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga4520e2fb456df3472ea105accd8e29fe">Wiper_update_All</a> (void)</td></tr>
<tr class="memdesc:ga4520e2fb456df3472ea105accd8e29fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function periodically in while function to fill the wipers with samples from the DMA buffer.  <br /></td></tr>
<tr class="separator:ga4520e2fb456df3472ea105accd8e29fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5975f93c4a6293369a814d655abec726" id="r_ga5975f93c4a6293369a814d655abec726"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga5975f93c4a6293369a814d655abec726">store_SampleFromDMABuffer</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper, uint16_t Buffer)</td></tr>
<tr class="memdesc:ga5975f93c4a6293369a814d655abec726"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy the current value from the DMA buffer to the Sample Array.  <br /></td></tr>
<tr class="separator:ga5975f93c4a6293369a814d655abec726"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6c4e494521a22138783ab6ead665ba93" id="r_ga6c4e494521a22138783ab6ead665ba93"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6c4e494521a22138783ab6ead665ba93">calculate_SmoothADCValue</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper)</td></tr>
<tr class="memdesc:ga6c4e494521a22138783ab6ead665ba93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate an average of all available samples.  <br /></td></tr>
<tr class="separator:ga6c4e494521a22138783ab6ead665ba93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9170e6f69a82ae21346de39b7b9717fa" id="r_ga9170e6f69a82ae21346de39b7b9717fa"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga9170e6f69a82ae21346de39b7b9717fa">get_SmoothedVlaueWithHysteresis</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper, uint16_t SamplesAverage)</td></tr>
<tr class="memdesc:ga9170e6f69a82ae21346de39b7b9717fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the average of samples is in a hysteresis area around the current value. It reduce noise a lot but the hysteresis threshold should be as low as possible to avoid big value jumps around the current value.  <br /></td></tr>
<tr class="separator:ga9170e6f69a82ae21346de39b7b9717fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf0315199ac1a2aef8e8fedd39426d781" id="r_gaf0315199ac1a2aef8e8fedd39426d781"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaf0315199ac1a2aef8e8fedd39426d781">get_ValueApproximatedToAccuracy</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper, uint16_t SamplesAverage, uint16_t CompareValue)</td></tr>
<tr class="memdesc:gaf0315199ac1a2aef8e8fedd39426d781"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the average of samples drifts away from the current smooth value inside the hysteresis range. It adjusts the value if necessary.  <br /></td></tr>
<tr class="separator:gaf0315199ac1a2aef8e8fedd39426d781"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf731d0fefc34ecab7cb554953b4591d4" id="r_gaf731d0fefc34ecab7cb554953b4591d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaf731d0fefc34ecab7cb554953b4591d4">reset_ValueDeviationCounters</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper)</td></tr>
<tr class="memdesc:gaf731d0fefc34ecab7cb554953b4591d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the hysteresis deviation counters.  <br /></td></tr>
<tr class="separator:gaf731d0fefc34ecab7cb554953b4591d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5e2f11d13d6a2aabb6f4f5cd18a01966" id="r_ga5e2f11d13d6a2aabb6f4f5cd18a01966"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga5e2f11d13d6a2aabb6f4f5cd18a01966">Wiper_manage_Interrupt</a> (ADC_HandleTypeDef *hadc)</td></tr>
<tr class="memdesc:ga5e2f11d13d6a2aabb6f4f5cd18a01966"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function in the HAL-Interrupt handler to set an internal interrupt flag for the wiper module.  <br /></td></tr>
<tr class="separator:ga5e2f11d13d6a2aabb6f4f5cd18a01966"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Get Functions</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>Use these functions to get values from the Whiper </p>
</td></tr>
<tr class="memitem:ga2b14f1d1a5a0e563fcc51f48172778bf" id="r_ga2b14f1d1a5a0e563fcc51f48172778bf"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga2b14f1d1a5a0e563fcc51f48172778bf">Wiper_get_RawValue</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper)</td></tr>
<tr class="memdesc:ga2b14f1d1a5a0e563fcc51f48172778bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the current raw ADC value from the DMA buffer.  <br /></td></tr>
<tr class="separator:ga2b14f1d1a5a0e563fcc51f48172778bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga124ac40da48f0c8394f841632409401a" id="r_ga124ac40da48f0c8394f841632409401a"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga124ac40da48f0c8394f841632409401a">Wiper_get_SmoothValue</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper)</td></tr>
<tr class="memdesc:ga124ac40da48f0c8394f841632409401a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the smoothed value of the ADC.  <br /></td></tr>
<tr class="separator:ga124ac40da48f0c8394f841632409401a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Study this part for details about the function of wipers. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga6c4e494521a22138783ab6ead665ba93" name="ga6c4e494521a22138783ab6ead665ba93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6c4e494521a22138783ab6ead665ba93">&#9670;&#160;</a></span>calculate_SmoothADCValue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calculate_SmoothADCValue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate an average of all available samples. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Declare a variable to store the sum of all samples</p>
<p>2. Calculate the sum of all samples</p>
<p>3. Divide the sum of all samples by the <a class="el" href="group___wiper___header.html#ga3992a43fac1d452edf605ff497a25030">NUMBER_OF_SAMPLES</a> to get the smoothed value.</p>
<p>4. Calculate hysteresis</p>

</div>
</div>
<a id="ga352768ca68e895645421a03936912afb" name="ga352768ca68e895645421a03936912afb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga352768ca68e895645421a03936912afb">&#9670;&#160;</a></span>check_ADCAlreadyInUse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool check_ADCAlreadyInUse </td>
          <td>(</td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hadc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the ADC-handler is already linked to the internal structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hadc</td><td>pointer to the HAL generated ADC-handle of the ADC that is used for the wiper </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>"true" if the ADC-handler is already linked, "false" it not </dd></dl>
<p>1. Loop trough all available ADCs of the microcontroller</p>
<p>2. Check if the current ADC matches with the ADC-handler. if yes: Return true.</p>

</div>
</div>
<a id="gaa1787e49726ff7779fcc109cf923cbd2" name="gaa1787e49726ff7779fcc109cf923cbd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa1787e49726ff7779fcc109cf923cbd2">&#9670;&#160;</a></span>get_NextFreeADCIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t get_NextFreeADCIndex </td>
          <td>(</td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hadc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the index number of the next free space in the ADC array of the internal structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hadc</td><td>pointer to the HAL generated ADC-handle of the ADC that is used for the wiper </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>index number of the next free space </dd></dl>
<p>1. Return the number of linked ADCs of the internal structure.</p>

</div>
</div>
<a id="ga9170e6f69a82ae21346de39b7b9717fa" name="ga9170e6f69a82ae21346de39b7b9717fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9170e6f69a82ae21346de39b7b9717fa">&#9670;&#160;</a></span>get_SmoothedVlaueWithHysteresis()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t get_SmoothedVlaueWithHysteresis </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>SamplesAverage</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the average of samples is in a hysteresis area around the current value. It reduce noise a lot but the hysteresis threshold should be as low as possible to avoid big value jumps around the current value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
    <tr><td class="paramname">SamplesAverage</td><td>average value calculated from existing samples </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>valid smoothed value. If the hysteresis is inactive, it will be equal to Sampled Average. </dd></dl>
<p>1. Setup variables used inside this function</p>
<p>2. Calculate Limits (Min/Max) of hysteresis range</p>
<p>3. Check if average value of the current samples is in the hysteresis range</p><ul>
<li>If yes: check if the samples average is accurate enough, correct it if necessary and save the value for return</li>
<li>If not: Save the samples average as return value and reset the value deviation counters witch are required for the accuracy approximation.</li>
</ul>
<p>4. Return the result</p>

</div>
</div>
<a id="gabcd8f67f9c76aee8447a9432432c6ecd" name="gabcd8f67f9c76aee8447a9432432c6ecd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabcd8f67f9c76aee8447a9432432c6ecd">&#9670;&#160;</a></span>get_ValidADCIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t get_ValidADCIndex </td>
          <td>(</td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hadc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the index of an ADC that is already linked to the internal structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hadc</td><td>pointer to the HAL generated ADC-handle of the ADC that is used for the wiper </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>valid ADC index. If the ADC is not linked yet, the function will return 0xFF. </dd></dl>
<p>1. Loop trough all available ADCs of the microcontroller</p>
<p>2. Check if the current ADC matches with the ADC-handler.</p><ul>
<li>if yes: Return the current number of the loop counter.</li>
</ul>

</div>
</div>
<a id="gaf0315199ac1a2aef8e8fedd39426d781" name="gaf0315199ac1a2aef8e8fedd39426d781"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf0315199ac1a2aef8e8fedd39426d781">&#9670;&#160;</a></span>get_ValueApproximatedToAccuracy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t get_ValueApproximatedToAccuracy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>SamplesAverage</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>CompareValue</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the average of samples drifts away from the current smooth value inside the hysteresis range. It adjusts the value if necessary. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
    <tr><td class="paramname">SamplesAverage</td><td>average value calculated from existing samples </td></tr>
    <tr><td class="paramname">CompareValue</td><td>value the samples average will be compared to </td></tr>
  </table>
  </dd>
</dl>
<p>1. If the samples average is bigger then the compare value, add the difference to the bigger values counter</p>
<p>2. If the samples average is smaller then the compare value, add the difference to the smaller values counter</p>
<p>3. If the bigger value counter overflows the threshold in reference to the smaller value counter, add +1 to the return value and reset counters.</p>
<p>4. If the smaller value counter overflows the threshold in reference to the bigger value counter, add -1 to the return value and reset counters.</p>
<p>5. If the Threshold does not overflow, return the original value.</p>

</div>
</div>
<a id="ga5dbc86bfd35ccd57acbe7b9def5cb1e0" name="ga5dbc86bfd35ccd57acbe7b9def5cb1e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5dbc86bfd35ccd57acbe7b9def5cb1e0">&#9670;&#160;</a></span>link_hadc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void link_hadc </td>
          <td>(</td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hadc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>IndexADC</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>link the hadc to the internal structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hadc</td><td>pointer to the HAL generated ADC-handle of the ADC that is used for the wiper </td></tr>
    <tr><td class="paramname">IndexADC</td><td>Index of the internal structure, where the ADC should be linked. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. link hadc to the internal structure</p>
<p>2. Count up the number of linked ADCs</p>

</div>
</div>
<a id="ga05d9a5a79f457185a2fa101ab8971e69" name="ga05d9a5a79f457185a2fa101ab8971e69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga05d9a5a79f457185a2fa101ab8971e69">&#9670;&#160;</a></span>link_WiperToInternalStructure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void link_WiperToInternalStructure </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>IndexADC</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>link ADC relevant parts of the wiper structure to the internal structure </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hadc</td><td>pointer to the HAL generated ADC-handle of the ADC that is used for the wiper </td></tr>
    <tr><td class="paramname">IndexADC</td><td>Index of the internal structure, where the ADC is linked. </td></tr>
  </table>
  </dd>
</dl>
<p>1. Get the Wiper Index</p>
<p>2. Store the Wiper Index to the Wiper structure to find it quick later.</p>
<p>3. Link the Wiper structure to the internal ADC structure at the Wiper Index</p>
<p>4. Count up the number of used channels of the ADC</p>

</div>
</div>
<a id="gaf731d0fefc34ecab7cb554953b4591d4" name="gaf731d0fefc34ecab7cb554953b4591d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf731d0fefc34ecab7cb554953b4591d4">&#9670;&#160;</a></span>reset_ValueDeviationCounters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reset_ValueDeviationCounters </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the hysteresis deviation counters. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>

</div>
</div>
<a id="ga5975f93c4a6293369a814d655abec726" name="ga5975f93c4a6293369a814d655abec726"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5975f93c4a6293369a814d655abec726">&#9670;&#160;</a></span>store_SampleFromDMABuffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void store_SampleFromDMABuffer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>Buffer</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copy the current value from the DMA buffer to the Sample Array. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Copy Value from DMA buffer to Sample Array at current Array-Index</p>
<p>2. Copy Value from DMA buffer to Value Raw to be able to return it quick to the user if needed.</p>
<p>3. Count up the sample array index for the next value.</p>
<p>4. If sample array index reaches the defined <a class="el" href="group___wiper___header.html#ga3992a43fac1d452edf605ff497a25030">NUMBER_OF_SAMPLES</a>, reset the index. The following values will overwrite the old ones.</p>

</div>
</div>
<a id="gab4493630c4a3361e1b45694ded6d1fe6" name="gab4493630c4a3361e1b45694ded6d1fe6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab4493630c4a3361e1b45694ded6d1fe6">&#9670;&#160;</a></span>Wiper_calibrate_HysteresisDeviationThreshold()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_calibrate_HysteresisDeviationThreshold </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>Threshold</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calibrate the Deviation Threshold. This will define, when the value will be corrected, if the value thrifts inside the hysteresis threshold. </p>
<p>Default: 200</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
    <tr><td class="paramname">Threshold</td><td>of the deviation. All values that are not equal to the current value are counted in separate counters, depending if they are lower or higher. If the counter of one direction + this threshold gets bigger then the counter of the other direction, the current value will be adjusted (+1 or -1). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Copy Threshold to Hyst_DeviationThreshold of the wiper structure</p>

</div>
</div>
<a id="ga1e29bd553a21cdf0ceb9d3c14b45a755" name="ga1e29bd553a21cdf0ceb9d3c14b45a755"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1e29bd553a21cdf0ceb9d3c14b45a755">&#9670;&#160;</a></span>Wiper_calibrate_HysteresisThreshold()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_calibrate_HysteresisThreshold </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>Threshold</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calibrate the hysteresis threshold. </p>
<p>Default: 4</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
    <tr><td class="paramname">Threshold</td><td>of the hysteresis. The hysteresis range will be from the current value - Threshold until the current value + Threshold. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Copy Threshold to Hyst_Threshold of the wiper structure</p>

</div>
</div>
<a id="ga2b14f1d1a5a0e563fcc51f48172778bf" name="ga2b14f1d1a5a0e563fcc51f48172778bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2b14f1d1a5a0e563fcc51f48172778bf">&#9670;&#160;</a></span>Wiper_get_RawValue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t Wiper_get_RawValue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the current raw ADC value from the DMA buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>value of the last ADC measurement </dd></dl>
<p>1. return the value of DMA butter for the ADC</p>

</div>
</div>
<a id="ga124ac40da48f0c8394f841632409401a" name="ga124ac40da48f0c8394f841632409401a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga124ac40da48f0c8394f841632409401a">&#9670;&#160;</a></span>Wiper_get_SmoothValue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t Wiper_get_SmoothValue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the smoothed value of the ADC. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>value of the smoothed ADC measurement </dd></dl>
<p>1. return the value of the wiper</p>

</div>
</div>
<a id="ga3769a4718f132d3298e7c6a9456667e9" name="ga3769a4718f132d3298e7c6a9456667e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3769a4718f132d3298e7c6a9456667e9">&#9670;&#160;</a></span>Wiper_init_ADC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_init_ADC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hadc</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Link HAL-ADC-handle used for wiper. </p>
<h1><a class="anchor" id="autotoc_md32"></a>
How to setup ADC for this module (as tested):</h1>
<ul>
<li>HCLK: 32MHz</li>
<li>Select ADC INx</li>
<li>Parameter Settings<ul>
<li>ADC_Settings<ul>
<li>Clock Prescaler: Synchronous clock mode divided by 4</li>
<li>Resolution: ADC 12-bit resolution</li>
<li>Data Alignment: Right alignment</li>
<li>Scan Direction: Forward</li>
<li>Continuous Conversation Mode: Disabled (ADC will be triggered in the update function of this module)</li>
<li>Discontinuous Conversation Mode: Disabled</li>
<li>DMA Continuous Requests: Disabled</li>
<li>End Of Conversion Selection: End of single conversion</li>
<li>Overrun behaviour: Overrun data preserved</li>
<li>Low Power Auto Wait: Disabled</li>
<li>Low Frequency Mode: Disabled</li>
<li>Auto Off: Disabled</li>
<li>Oversampling Mode: Disabled</li>
</ul>
</li>
<li>ADC_REGULAR_ConversionMode<ul>
<li>Sampling Time: 3.5 Cycles</li>
<li>External Trigger Conversion Source: Regular Conversion launched by software.</li>
<li>External Trigger Conversion Edge: None</li>
</ul>
</li>
<li>WatchDog: Disable</li>
</ul>
</li>
<li>NVIC Settings<ul>
<li>DMA1 channel 1 interrupt: enable</li>
<li>ADC, COMP1 and COMP2 interrupt: enable</li>
</ul>
</li>
<li>DMA Settings<ul>
<li>DMA Request: ADC</li>
<li>Channel: DMA1 Channel 1</li>
<li>Direction: Peripheral To Memory</li>
<li>Priority: Medium</li>
<li>DMA Request Settings:<ul>
<li>Mode: Normal</li>
<li>Increment Address: Memory</li>
<li>Data Width: Half Word (because we use 12bit ADC)</li>
</ul>
</li>
</ul>
</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>It is necessary to initialize the ADC in the same order as the channels of the ADC are set up. So ADC1 Ch1 first and ADCx Chx last. Otherwise the ADC value will be written to the wrong wiper structure. It is no problem to skip channels if they are not in use (The skipped channels must not be set up in Cube MX!).</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
    <tr><td class="paramname">hadc</td><td>pointer to the HAL generated ADC-handle of the ADC that is used for the wiper </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Check if the ADC-handler is already linked.</p><ul>
<li>if yes: find the valid ADC index of the internal structure.</li>
<li>if no: find the next free ADC index and link the ADC handle to the structure</li>
</ul>
<p>2. Link the ADC relevant parts of the Wiper structure to the internal structure at the valid ADC index.</p>

</div>
</div>
<a id="ga6ea4077964bf0c78ed5cb2e918fe07e7" name="ga6ea4077964bf0c78ed5cb2e918fe07e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6ea4077964bf0c78ed5cb2e918fe07e7">&#9670;&#160;</a></span>Wiper_init_Hysteresis()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_init_Hysteresis </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set hysteresis settings to default. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Store default hysteresis values to wiper structure.</p>

</div>
</div>
<a id="ga5e2f11d13d6a2aabb6f4f5cd18a01966" name="ga5e2f11d13d6a2aabb6f4f5cd18a01966"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5e2f11d13d6a2aabb6f4f5cd18a01966">&#9670;&#160;</a></span>Wiper_manage_Interrupt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_manage_Interrupt </td>
          <td>(</td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hadc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function in the HAL-Interrupt handler to set an internal interrupt flag for the wiper module. </p>
<p>Here is an example: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> HAL_ADC_ConvCpltCallback(ADC_HandleTypeDef* hadc)</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_function" href="group___wiper___header.html#ga5e2f11d13d6a2aabb6f4f5cd18a01966">Wiper_manage_Interrupt</a>(&amp;UsersWhiper, hadc);</div>
<div class="line">}</div>
<div class="ttc" id="agroup___wiper___header_html_ga5e2f11d13d6a2aabb6f4f5cd18a01966"><div class="ttname"><a href="group___wiper___header.html#ga5e2f11d13d6a2aabb6f4f5cd18a01966">Wiper_manage_Interrupt</a></div><div class="ttdeci">void Wiper_manage_Interrupt(ADC_HandleTypeDef *hadc)</div><div class="ttdoc">Call this function in the HAL-Interrupt handler to set an internal interrupt flag for the wiper modul...</div><div class="ttdef"><b>Definition</b> wiper.c:490</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hadc</td><td>pointer to the HAL generated ADC-handle of the ADC that is used for the wiper </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Loop through all active ADCs</p>
<p>2. If current ADC matches hadc, set interrupt flag</p>

</div>
</div>
<a id="ga98a7e3568b3c8c797e29f3178f370f52" name="ga98a7e3568b3c8c797e29f3178f370f52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga98a7e3568b3c8c797e29f3178f370f52">&#9670;&#160;</a></span>Wiper_start_All()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_start_All </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to start the ADC over DMA conversion. Call this function once when the ADC should start. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Loop through all active ADCs</p>
<p>2. Start ADC on DMA for each active ADC</p>

</div>
</div>
<a id="ga4520e2fb456df3472ea105accd8e29fe" name="ga4520e2fb456df3472ea105accd8e29fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4520e2fb456df3472ea105accd8e29fe">&#9670;&#160;</a></span>Wiper_update_All()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_update_All </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function periodically in while function to fill the wipers with samples from the DMA buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Loop through all active ADCs. Inside the loop:</p>
<p>2. Check if the current ADC was interrupted.</p><ul>
<li>If no: leave function.</li>
</ul>
<p>3. Reset Interrupt Flag of current ADC</p>
<p>4. loop trough all active channels of the current ADC</p>
<p>5. Store the data of the DMA buffer to the wiper that belongs to the current channel</p>
<p>6. Calculate the smoothed value for the wiper that belongs to the current channel</p>
<p>7. Restart the ADC-DMA of the currently interrupted ADC as we are in single conservation mode.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
