<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Manual for Developing a DAW-Controller: Software Demo Projects: Header</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="mdw_Logo_weiss.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">Manual for Developing a DAW-Controller: Software Demo Projects<span id="projectnumber">&#160;Demo Project</span>
   </div>
   <div id="projectbrief">This is the software module that contains demo projects for the deploma thesis: &quot;Handbuch zur Entwicklung eines DAW-Controllers&quot; (Eng: Manual for Developing a DAW-Controller).</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group___wiper___header.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle"><div class="title">Header<div class="ingroups"><a class="el" href="group___motor_fader.html">Motorized Fader</a> &raquo; <a class="el" href="group___wiper_motor_fader.html">Wiper module</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Study this part for a quick overview of wiper functions.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:wiper_8h" id="r_wiper_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wiper_8h.html">wiper.h</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gaefaa9e5288b9ef7da21f894a38dcfbb5" id="r_gaefaa9e5288b9ef7da21f894a38dcfbb5"><td class="memItemLeft" align="right" valign="top"><a id="gaefaa9e5288b9ef7da21f894a38dcfbb5" name="gaefaa9e5288b9ef7da21f894a38dcfbb5"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NUM_ALL_ADC_CHANNELS</b>&#160;&#160;&#160;19</td></tr>
<tr class="memdesc:gaefaa9e5288b9ef7da21f894a38dcfbb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of available ADC channels of the MCU. Change this value if the used MCU offers more channels. <br /></td></tr>
<tr class="separator:gaefaa9e5288b9ef7da21f894a38dcfbb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3c114292578f2c874fc0a04494864940" id="r_ga3c114292578f2c874fc0a04494864940"><td class="memItemLeft" align="right" valign="top"><a id="ga3c114292578f2c874fc0a04494864940" name="ga3c114292578f2c874fc0a04494864940"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NUM_ALL_ADC_ON_MCU</b>&#160;&#160;&#160;1</td></tr>
<tr class="memdesc:ga3c114292578f2c874fc0a04494864940"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of available ADCs (not ADC channels!) <br /></td></tr>
<tr class="separator:ga3c114292578f2c874fc0a04494864940"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3992a43fac1d452edf605ff497a25030" id="r_ga3992a43fac1d452edf605ff497a25030"><td class="memItemLeft" align="right" valign="top"><a id="ga3992a43fac1d452edf605ff497a25030" name="ga3992a43fac1d452edf605ff497a25030"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NUMBER_OF_SAMPLES</b>&#160;&#160;&#160;100</td></tr>
<tr class="memdesc:ga3992a43fac1d452edf605ff497a25030"><td class="mdescLeft">&#160;</td><td class="mdescRight">Define for the number of sampled values. If the smooth value is not clean enough, increase this number. Be careful that the ADC does not get to slow by using to many samples. <br /></td></tr>
<tr class="separator:ga3992a43fac1d452edf605ff497a25030"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Structures</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>This structure is used to store all information about the used wiper. </p>
</td></tr>
<tr class="memitem:ga089384dc135a4b013a819353eb9d7801" id="r_ga089384dc135a4b013a819353eb9d7801"><td class="memItemLeft" align="right" valign="top"><a id="ga089384dc135a4b013a819353eb9d7801" name="ga089384dc135a4b013a819353eb9d7801"></a>
typedef struct Wiper_structTd&#160;</td><td class="memItemRight" valign="bottom"><b>Wiper_structTd</b></td></tr>
<tr class="separator:ga089384dc135a4b013a819353eb9d7801"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Initialize</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>Use these functions to initialize the wiper of the fader </p>
</td></tr>
<tr class="memitem:ga3769a4718f132d3298e7c6a9456667e9" id="r_ga3769a4718f132d3298e7c6a9456667e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga3769a4718f132d3298e7c6a9456667e9">Wiper_init_ADC</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper, ADC_HandleTypeDef *hadc)</td></tr>
<tr class="memdesc:ga3769a4718f132d3298e7c6a9456667e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Link HAL-ADC-handle used for wiper.  <br /></td></tr>
<tr class="separator:ga3769a4718f132d3298e7c6a9456667e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6ea4077964bf0c78ed5cb2e918fe07e7" id="r_ga6ea4077964bf0c78ed5cb2e918fe07e7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6ea4077964bf0c78ed5cb2e918fe07e7">Wiper_init_Hysteresis</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper)</td></tr>
<tr class="memdesc:ga6ea4077964bf0c78ed5cb2e918fe07e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set hysteresis settings to default.  <br /></td></tr>
<tr class="separator:ga6ea4077964bf0c78ed5cb2e918fe07e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Calibrate</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>Use this function to calibrate the wiper</p>
<dl class="section note"><dt>Note</dt><dd>These functions are not essential, but may be helpful to improve the performance. </dd></dl>
<h1><a class="anchor" id="autotoc_md39"></a>
How to calibrate:</h1>
<h2><a class="anchor" id="autotoc_md40"></a>
Hardware (if possible):</h2>
<ul>
<li>make sure that the ADC is working with a clean Vref </li>
</ul>
<h2><a class="anchor" id="autotoc_md41"></a>
Software:</h2>
<ol type="1">
<li>Change HAL-Settings to get as close as possible to the preferred result. Where to adapt:<ul>
<li>HCLK (if it can be changed without affecting other components) and / or Prescaler to reduce clock of ADC</li>
<li>Sampling Time</li>
</ul>
</li>
<li>Change define of <a class="el" href="#ga3992a43fac1d452edf605ff497a25030">NUMBER_OF_SAMPLES</a> until value is closer to the preferred result</li>
<li>Change hysteresis threshold to reduce noise</li>
<li>Change deviation threshold to get closer to the exact value inside the hysteresis range. </li>
</ol>
</td></tr>
<tr class="memitem:ga1e29bd553a21cdf0ceb9d3c14b45a755" id="r_ga1e29bd553a21cdf0ceb9d3c14b45a755"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga1e29bd553a21cdf0ceb9d3c14b45a755">Wiper_calibrate_HysteresisThreshold</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper, uint8_t Threshold)</td></tr>
<tr class="memdesc:ga1e29bd553a21cdf0ceb9d3c14b45a755"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calibrate the hysteresis threshold.  <br /></td></tr>
<tr class="separator:ga1e29bd553a21cdf0ceb9d3c14b45a755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab4493630c4a3361e1b45694ded6d1fe6" id="r_gab4493630c4a3361e1b45694ded6d1fe6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gab4493630c4a3361e1b45694ded6d1fe6">Wiper_calibrate_HysteresisDeviationThreshold</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper, uint8_t Threshold)</td></tr>
<tr class="memdesc:gab4493630c4a3361e1b45694ded6d1fe6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calibrate the Deviation Threshold. This will define, when the value will be corrected, if the value thrifts inside the hysteresis threshold.  <br /></td></tr>
<tr class="separator:gab4493630c4a3361e1b45694ded6d1fe6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Process ADC</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>Use these functions to control the ADC </p>
</td></tr>
<tr class="memitem:ga98a7e3568b3c8c797e29f3178f370f52" id="r_ga98a7e3568b3c8c797e29f3178f370f52"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga98a7e3568b3c8c797e29f3178f370f52">Wiper_start_All</a> (void)</td></tr>
<tr class="memdesc:ga98a7e3568b3c8c797e29f3178f370f52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to start the ADC over DMA conversion. Call this function once when the ADC should start.  <br /></td></tr>
<tr class="separator:ga98a7e3568b3c8c797e29f3178f370f52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4520e2fb456df3472ea105accd8e29fe" id="r_ga4520e2fb456df3472ea105accd8e29fe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga4520e2fb456df3472ea105accd8e29fe">Wiper_update_All</a> (void)</td></tr>
<tr class="memdesc:ga4520e2fb456df3472ea105accd8e29fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function periodically in while function to fill the wipers with samples from the DMA buffer.  <br /></td></tr>
<tr class="separator:ga4520e2fb456df3472ea105accd8e29fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5e2f11d13d6a2aabb6f4f5cd18a01966" id="r_ga5e2f11d13d6a2aabb6f4f5cd18a01966"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga5e2f11d13d6a2aabb6f4f5cd18a01966">Wiper_manage_Interrupt</a> (ADC_HandleTypeDef *hadc)</td></tr>
<tr class="memdesc:ga5e2f11d13d6a2aabb6f4f5cd18a01966"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function in the HAL-Interrupt handler to set an internal interrupt flag for the wiper module.  <br /></td></tr>
<tr class="separator:ga5e2f11d13d6a2aabb6f4f5cd18a01966"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Get Functions</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>Use these functions to get values from the Wiper </p>
</td></tr>
<tr class="memitem:ga2b14f1d1a5a0e563fcc51f48172778bf" id="r_ga2b14f1d1a5a0e563fcc51f48172778bf"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga2b14f1d1a5a0e563fcc51f48172778bf">Wiper_get_RawValue</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper)</td></tr>
<tr class="memdesc:ga2b14f1d1a5a0e563fcc51f48172778bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the current raw ADC value from the DMA buffer.  <br /></td></tr>
<tr class="separator:ga2b14f1d1a5a0e563fcc51f48172778bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga124ac40da48f0c8394f841632409401a" id="r_ga124ac40da48f0c8394f841632409401a"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga124ac40da48f0c8394f841632409401a">Wiper_get_SmoothValue</a> (<a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *Wiper)</td></tr>
<tr class="memdesc:ga124ac40da48f0c8394f841632409401a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the smoothed value of the ADC.  <br /></td></tr>
<tr class="separator:ga124ac40da48f0c8394f841632409401a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Study this part for a quick overview of wiper functions. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gab4493630c4a3361e1b45694ded6d1fe6" name="gab4493630c4a3361e1b45694ded6d1fe6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab4493630c4a3361e1b45694ded6d1fe6">&#9670;&#160;</a></span>Wiper_calibrate_HysteresisDeviationThreshold()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_calibrate_HysteresisDeviationThreshold </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>Threshold</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calibrate the Deviation Threshold. This will define, when the value will be corrected, if the value thrifts inside the hysteresis threshold. </p>
<p>Default: 200</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
    <tr><td class="paramname">Threshold</td><td>of the deviation. All values that are not equal to the current value are counted in separate counters, depending if they are lower or higher. If the counter of one direction + this threshold gets bigger then the counter of the other direction, the current value will be adjusted (+1 or -1). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Copy Threshold to Hyst_DeviationThreshold of the wiper structure</p>

</div>
</div>
<a id="ga1e29bd553a21cdf0ceb9d3c14b45a755" name="ga1e29bd553a21cdf0ceb9d3c14b45a755"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1e29bd553a21cdf0ceb9d3c14b45a755">&#9670;&#160;</a></span>Wiper_calibrate_HysteresisThreshold()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_calibrate_HysteresisThreshold </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>Threshold</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calibrate the hysteresis threshold. </p>
<p>Default: 4</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
    <tr><td class="paramname">Threshold</td><td>of the hysteresis. The hysteresis range will be from the current value - Threshold until the current value + Threshold. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Copy Threshold to Hyst_Threshold of the wiper structure</p>

</div>
</div>
<a id="ga2b14f1d1a5a0e563fcc51f48172778bf" name="ga2b14f1d1a5a0e563fcc51f48172778bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2b14f1d1a5a0e563fcc51f48172778bf">&#9670;&#160;</a></span>Wiper_get_RawValue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t Wiper_get_RawValue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the current raw ADC value from the DMA buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>value of the last ADC measurement </dd></dl>
<p>1. return the value of DMA butter for the ADC</p>

</div>
</div>
<a id="ga124ac40da48f0c8394f841632409401a" name="ga124ac40da48f0c8394f841632409401a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga124ac40da48f0c8394f841632409401a">&#9670;&#160;</a></span>Wiper_get_SmoothValue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t Wiper_get_SmoothValue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the smoothed value of the ADC. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>value of the smoothed ADC measurement </dd></dl>
<p>1. return the value of the wiper</p>

</div>
</div>
<a id="ga3769a4718f132d3298e7c6a9456667e9" name="ga3769a4718f132d3298e7c6a9456667e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3769a4718f132d3298e7c6a9456667e9">&#9670;&#160;</a></span>Wiper_init_ADC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_init_ADC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hadc</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Link HAL-ADC-handle used for wiper. </p>
<h1><a class="anchor" id="autotoc_md38"></a>
How to setup ADC for this module (as tested):</h1>
<ul>
<li>HCLK: 32MHz</li>
<li>Select ADC INx</li>
<li>Parameter Settings<ul>
<li>ADC_Settings<ul>
<li>Clock Prescaler: Synchronous clock mode divided by 4</li>
<li>Resolution: ADC 12-bit resolution</li>
<li>Data Alignment: Right alignment</li>
<li>Scan Direction: Forward</li>
<li>Continuous Conversation Mode: Disabled (ADC will be triggered in the update function of this module)</li>
<li>Discontinuous Conversation Mode: Disabled</li>
<li>DMA Continuous Requests: Disabled</li>
<li>End Of Conversion Selection: End of single conversion</li>
<li>Overrun behaviour: Overrun data preserved</li>
<li>Low Power Auto Wait: Disabled</li>
<li>Low Frequency Mode: Disabled</li>
<li>Auto Off: Disabled</li>
<li>Oversampling Mode: Disabled</li>
</ul>
</li>
<li>ADC_REGULAR_ConversionMode<ul>
<li>Sampling Time: 3.5 Cycles</li>
<li>External Trigger Conversion Source: Regular Conversion launched by software.</li>
<li>External Trigger Conversion Edge: None</li>
</ul>
</li>
<li>WatchDog: Disable</li>
</ul>
</li>
<li>NVIC Settings<ul>
<li>DMA1 channel 1 interrupt: enable</li>
<li>ADC, COMP1 and COMP2 interrupt: enable</li>
</ul>
</li>
<li>DMA Settings<ul>
<li>DMA Request: ADC</li>
<li>Channel: DMA1 Channel 1</li>
<li>Direction: Peripheral To Memory</li>
<li>Priority: Medium</li>
<li>DMA Request Settings:<ul>
<li>Mode: Normal</li>
<li>Increment Address: Memory</li>
<li>Data Width: Half Word (because we use 12bit ADC)</li>
</ul>
</li>
</ul>
</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>It is necessary to initialize the ADC in the same order as the channels of the ADC are set up. So ADC1 Ch1 first and ADCx Chx last. Otherwise the ADC value will be written to the wrong wiper structure. It is no problem to skip channels if they are not in use (The skipped channels must not be set up in Cube MX!).</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
    <tr><td class="paramname">hadc</td><td>pointer to the HAL generated ADC-handle of the ADC that is used for the wiper </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Check if the ADC-handler is already linked.</p><ul>
<li>if yes: find the valid ADC index of the internal structure.</li>
<li>if no: find the next free ADC index and link the ADC handle to the structure</li>
</ul>
<p>2. Link the ADC relevant parts of the Wiper structure to the internal structure at the valid ADC index.</p>

</div>
</div>
<a id="ga6ea4077964bf0c78ed5cb2e918fe07e7" name="ga6ea4077964bf0c78ed5cb2e918fe07e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6ea4077964bf0c78ed5cb2e918fe07e7">&#9670;&#160;</a></span>Wiper_init_Hysteresis()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_init_Hysteresis </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_wiper__struct_td.html">Wiper_structTd</a> *</td>          <td class="paramname"><span class="paramname"><em>Wiper</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set hysteresis settings to default. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Store default hysteresis values to wiper structure.</p>

</div>
</div>
<a id="ga5e2f11d13d6a2aabb6f4f5cd18a01966" name="ga5e2f11d13d6a2aabb6f4f5cd18a01966"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5e2f11d13d6a2aabb6f4f5cd18a01966">&#9670;&#160;</a></span>Wiper_manage_Interrupt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_manage_Interrupt </td>
          <td>(</td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hadc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function in the HAL-Interrupt handler to set an internal interrupt flag for the wiper module. </p>
<p>Here is an example: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> HAL_ADC_ConvCpltCallback(ADC_HandleTypeDef* hadc)</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_function" href="#ga5e2f11d13d6a2aabb6f4f5cd18a01966">Wiper_manage_Interrupt</a>(&amp;UsersWhiper, hadc);</div>
<div class="line">}</div>
<div class="ttc" id="agroup___wiper___header_html_ga5e2f11d13d6a2aabb6f4f5cd18a01966"><div class="ttname"><a href="#ga5e2f11d13d6a2aabb6f4f5cd18a01966">Wiper_manage_Interrupt</a></div><div class="ttdeci">void Wiper_manage_Interrupt(ADC_HandleTypeDef *hadc)</div><div class="ttdoc">Call this function in the HAL-Interrupt handler to set an internal interrupt flag for the wiper modul...</div><div class="ttdef"><b>Definition</b> wiper.c:490</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hadc</td><td>pointer to the HAL generated ADC-handle of the ADC that is used for the wiper </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Loop through all active ADCs</p>
<p>2. If current ADC matches hadc, set interrupt flag</p>

</div>
</div>
<a id="ga98a7e3568b3c8c797e29f3178f370f52" name="ga98a7e3568b3c8c797e29f3178f370f52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga98a7e3568b3c8c797e29f3178f370f52">&#9670;&#160;</a></span>Wiper_start_All()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_start_All </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to start the ADC over DMA conversion. Call this function once when the ADC should start. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Wiper</td><td>pointer to the users wiper structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Loop through all active ADCs</p>
<p>2. Start ADC on DMA for each active ADC</p>

</div>
</div>
<a id="ga4520e2fb456df3472ea105accd8e29fe" name="ga4520e2fb456df3472ea105accd8e29fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4520e2fb456df3472ea105accd8e29fe">&#9670;&#160;</a></span>Wiper_update_All()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Wiper_update_All </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function periodically in while function to fill the wipers with samples from the DMA buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>
<p>1. Loop through all active ADCs. Inside the loop:</p>
<p>2. Check if the current ADC was interrupted.</p><ul>
<li>If no: leave function.</li>
</ul>
<p>3. Reset Interrupt Flag of current ADC</p>
<p>4. loop trough all active channels of the current ADC</p>
<p>5. Store the data of the DMA buffer to the wiper that belongs to the current channel</p>
<p>6. Calculate the smoothed value for the wiper that belongs to the current channel</p>
<p>7. Restart the ADC-DMA of the currently interrupted ADC as we are in single conservation mode.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
