<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diploma Thesis DAW-Controller: Button Matrix: Motorized Fader</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="mdw_Logo_weiss.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">Diploma Thesis DAW-Controller: Button Matrix<span id="projectnumber">&#160;Demo Project</span>
   </div>
   <div id="projectbrief">This Project shows how to setup and use a button matrix.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group___motor_fader.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Topics</a>  </div>
  <div class="headertitle"><div class="title">Motorized Fader</div></div>
</div><!--header-->
<div class="contents">

<p>This module can be used to program an Fader with DC-Motor.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
Topics</h2></td></tr>
<tr class="memitem:group___motor_fader___header" id="r_group___motor_fader___header"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___motor_fader___header.html">Header</a></td></tr>
<tr class="memdesc:group___motor_fader___header"><td class="mdescLeft">&#160;</td><td class="mdescRight">Study this part for a quick overview. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group___p_i_d___controller" id="r_group___p_i_d___controller"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___p_i_d___controller.html">PID controller</a></td></tr>
<tr class="memdesc:group___p_i_d___controller"><td class="mdescLeft">&#160;</td><td class="mdescRight">This module is used to calculate a PID output to reach a specific and stable target. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group___t_b6612_f_n_g" id="r_group___t_b6612_f_n_g"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___t_b6612_f_n_g.html">TB6612FNG Dual DC motor driver</a></td></tr>
<tr class="memdesc:group___t_b6612_f_n_g"><td class="mdescLeft">&#160;</td><td class="mdescRight">This module can be used to control the TB6612 driver for DC motors. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group___t_s_c_button" id="r_group___t_s_c_button"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___t_s_c_button.html">TSC Button</a></td></tr>
<tr class="memdesc:group___t_s_c_button"><td class="mdescLeft">&#160;</td><td class="mdescRight">This module manages the STM32 touch sense controller to use is as capacitive buttons. It also provides the raw TSC-values for each button. This may be useful for non binary use. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group___wiper_motor_fader" id="r_group___wiper_motor_fader"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___wiper_motor_fader.html">Wiper module</a></td></tr>
<tr class="memdesc:group___wiper_motor_fader"><td class="mdescLeft">&#160;</td><td class="mdescRight">This module is responsible to handle the wiper of the motorized Fader. It will read the ADC, smooth the values and returns the results. The ADC measurement working on DMA, so the CPU will not be affected. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group___motor_fader___source" id="r_group___motor_fader___source"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___motor_fader___source.html">Source</a></td></tr>
<tr class="memdesc:group___motor_fader___source"><td class="mdescLeft">&#160;</td><td class="mdescRight">Study this part for a details. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This module can be used to program an Fader with DC-Motor. </p>
<h1><a class="anchor" id="autotoc_md19"></a>
How to use:</h1>
<ol type="1">
<li>Declare an object of <a class="el" href="struct_motorized_fader__struct_td.html" title="Main structure to store all data for the fader. The user has to declare one object of this data type ...">MotorizedFader_structTd</a> type for each used fader</li>
<li>Initialize Faders:<ul>
<li>Fader Data:<ul>
<li><a class="el" href="group___motor_fader___header.html#gab68de15bad1210ec835765bcdd319433" title="Link the Fader to the internal structure for internal use.">MotorizedFader_init_Structure()</a></li>
<li><a class="el" href="group___motor_fader___header.html#ga273d5d0c65a9806145ca5f7c4ee79888" title="Initialize the start force the fader needs to start moving. To find the CCR value needed to move the ...">MotorizedFader_init_StartForce()</a></li>
<li><a class="el" href="group___motor_fader___header.html#ga7cc201b68ed12f7e9e4a2dd37039a72d" title="Initialize a CCR Range, where the motor will not move. This is required to avoid resonating around th...">MotorizedFader_init_StopRange()</a></li>
</ul>
</li>
<li>Wiper:<ul>
<li><a class="el" href="group___motor_fader___header.html#gad80274af9a746926c0030f1e4e00688f" title="Link the ADC for the wiper. For details and how to set up ADC please look at the documentation of Wip...">MotorizedFader_init_Wiper()</a></li>
</ul>
</li>
<li>Touch Sense:<ul>
<li><a class="el" href="group___motor_fader___header.html#ga57bb8237c13779fbba26b58723e5bdde" title="Link the touch sense controller for the touch line. For details and how to setup TSC please look at t...">MotorizedFader_init_TouchTSC()</a></li>
<li><a class="el" href="group___motor_fader___header.html#ga030d02d19d49a815882643c8110d7500" title="Initialize the threshold value where the touch line will change between touched and released....">MotorizedFader_init_TouchThreshold()</a></li>
<li><a class="el" href="group___motor_fader___header.html#gab02e785ee47f373cfd425b806a65e601" title="Initialize the discharge time for the sample capacitor of the TSC group. This value is used fop all T...">MotorizedFader_init_TouchDischargeTimeMsAll()</a> (initialize this once for all faders)</li>
</ul>
</li>
<li>Motor:<ul>
<li><a class="el" href="group___motor_fader___header.html#ga4e3cf4b4384fae0bfbb307f5ee3386c0" title="Link Pin In1 for the Motor Driver. For details please look at the documentation of MotorDriver_init_P...">MotorizedFader_init_MotorPinIn1()</a></li>
<li><a class="el" href="group___motor_fader___header.html#gafe744f9ad2f113d732632f4865f12afe" title="Link Pin In2 for the Motor Driver. For details please look at the documentation of MotorDriver_init_P...">MotorizedFader_init_MotorPinIn2()</a></li>
<li><a class="el" href="group___motor_fader___header.html#ga486e0b44341a0f6e98fbc265787e59b7" title="Link Pin STBY for the Motor Driver. For details please look at the documentation of MotorDriver_init_...">MotorizedFader_init_MotorPinSTBY()</a></li>
<li><a class="el" href="group___motor_fader___header.html#gabda87f9cb0f5243cc31f0004b1ff7447" title="Link PWM used for the Motor Driver. For details and how to setup PWM please look at the documentation...">MotorizedFader_init_MotorPWM()</a></li>
</ul>
</li>
<li>PID:<ul>
<li><a class="el" href="group___motor_fader___header.html#ga20c5b8d83977cf80a168539daeca8bdc" title="Initialize the PID structure used by the fader. For details please look at the documentation of PID_i...">MotorizedFader_init_PID()</a>;</li>
<li><a class="el" href="group___motor_fader___header.html#ga4f15ed1ee6d62c4903e9c165537acb19" title="Initialize PID Output range For details please look at the documentation of PID_set_OutputMinMax().">MotorizedFader_init_PIDMaxCCR()</a></li>
<li><a class="el" href="group___motor_fader___header.html#ga23cd2d30fd7c4e6869162c953625b3ee" title="Initialize PID coefficients for tuning the PIT-Terms. For details please look at the documentation of...">MotorizedFader_init_PIDKpKiKd()</a></li>
<li><a class="el" href="group___motor_fader___header.html#gaecc08367c7c6fc646cefa878c6388110" title="Initialize the low pass for the PID D-Term. For details please look at the documentation of PID_set_L...">MotorizedFader_init_PIDLowPass()</a></li>
<li><a class="el" href="group___motor_fader___header.html#gabe4ccb946b406da01f4b90c9db2e5cf4" title="Initialize the sample to control the PID update frequency. For details please look at the documentati...">MotorizedFader_init_PIDSampleTimeInMs()</a></li>
</ul>
</li>
</ul>
</li>
<li>Setup Interrupt functions:<ul>
<li><a class="el" href="group___motor_fader___header.html#ga2abcc6b1f7bf263dd0b38ce7bbe1a45b" title="Call this function in the HAL ADC interrupt. For details please look at the documentation of Wiper_ma...">MotorizedFader_manage_WiperInterrupt()</a></li>
<li><a class="el" href="group___motor_fader___header.html#gafd9c406bade7d7d70e4bf78d2aa78f2f" title="Call this funciton in the HAL TSC Interrupt For details please look at the documentation of TSCButton...">MotorizedFader_manage_TSCInterrupt()</a></li>
</ul>
</li>
<li>Start all faders:<ul>
<li><a class="el" href="group___motor_fader___header.html#ga7484953e13e33e3d9f1a6144d33432dc" title="Call this function once to start all faders.">MotorizedFader_start_All()</a></li>
</ul>
</li>
<li>In while Loop: update all faders<ul>
<li><a class="el" href="group___motor_fader___header.html#ga46035bcdf3e5e7c3248b100494ff38ce" title="Call this function periodically in the main while loop to update all faders.">MotorizedFader_update_All()</a></li>
</ul>
</li>
<li>Use these functions to access a fader in the running program:<ul>
<li><a class="el" href="group___motor_fader___header.html#ga592c8f1f9306b7fd683b173a1a0baa4d" title="Use this function to get the wiper value. This value can be used to control something else,...">MotorizedFader_get_WiperValue()</a></li>
<li><a class="el" href="group___motor_fader___header.html#ga4325f63723e3080824ae78c324f344bd" title="Use this function to check if a fader is touched or not.">MotorizedFader_get_TSCState()</a></li>
<li><a class="el" href="group___motor_fader___header.html#ga600f62c96a0386c223fb5875bcbdd0bc" title="Use this function to set a Target value for the fader. It will move to this value automatically.">MotorizedFader_set_Target()</a></li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md20"></a>
Hardware (as used for testing)</h1>
<ul>
<li>Code was tested with an 100mm linear 10k ALPS motorized fader</li>
<li>Motor Driver: TB6612FNG</li>
<li>TSC Sample capacitor: 47nF</li>
<li>TSC serial resistor on Touch line: 10k</li>
<li>Motor Supply: 9V</li>
</ul>
<h1><a class="anchor" id="autotoc_md21"></a>
Tips</h1>
<ul>
<li>If the fader starts to resonate, you have to check Kp, Ki, Kd, low pass, Start Force and Stop Range. This module was tested with 100mm linear ALPS faders (RSA0N11M9A07).</li>
<li>It is recommended to look for other faders than the Alps faders for new designs, as the discontinued the product.</li>
<li>Even if only faders of the same type are used, it may be necessary to setup different PID calibrations. Many faders are very inaccurate and sluggish according to their specs. If they are a bit worn over time, this problem gets bigger and the faders need different regulation (if regulation is still possible. Very old faders have to be replaced)</li>
<li>If you hear high frequency noise, check your PWM frequency in Cube MX (PWM-Freuqency = (TIM-CLK / AutoReloadRegister)).</li>
<li>Take your time to find the right threshold for each Touch line. If the threshold is not accurate, it my get tricky to get the faders stable because the motor stops always when the fader is touched.</li>
</ul>
<h1><a class="anchor" id="autotoc_md22"></a>
Links</h1>
<ul>
<li><a class="el" href="group___t_b6612_f_n_g.html#TB6612FNG_Datasheet">TB6612FNG Motor Driver data sheet</a></li>
<li>Helpful PID tutorial (PID calculations are based on this source):<ul>
<li><a href="https://www.youtube.com/watch?v=zOByx3Izf5U">PID Controller Implementation in Software - Phil's Lab #6</a></li>
<li><a href="https://www.phils-lab.net/videos">More Phil's Lab videos</a></li>
</ul>
</li>
<li><a href="https://controllerstech.com/">CONTROLLERSTECH: a helpful blog to learn how to work with STM32, including ADC and PWM</a></li>
<li><a href="https://wiki.st.com/stm32mcu/wiki/Introduction_to_touch_sensing_with_STM32">STM32 TSC Overview</a></li>
<li><a href="https://wiki.st.com/stm32mcu/wiki/Getting_started_with_ADC">STM32 ADC Overview</a></li>
<li><a href="https://cdn-reichelt.de/documents/datenblatt/X200/402685_RSA0N11M9A07.pdf">Datasheet for ALPS 100mm Fader used for testing</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
